% Function that calculates structure factors Fhkl and Fourier coefficients% V(g) (in volts) for an fcc crystal. Fourier coefficients% in volts are V(g)=(Fhkl/Vcell)*47.87, where Vcell is cell volume in% Angstroms^3, and Fhkl=Sumi[f(g)*exp(-2*pi*i*(g.ri))] for unit cell with% atoms at ri and atomic scattering factor f(g). DW factor given by% exp(-0.3g^2). Here g^2=(1/d)^2=(h^2+k^2+l^2)/a^2. Atomic scattering% factor f(g) is in units of Angstroms and is calculated using Doyle-Turner% sum of Gaussians. Function returns 3D matrix of Fourier coefficients.function [Vg,DW]=FCC(Z,a,N,DW)% Atom coordinates for FCC    R={[0,0,0];[0.5,0.5,0];[0.5,0,0.5];[0,0.5,0.5]};% Get Gaussian coefficients and make A and B matrices for atomic scattering% factors.    Gcoeff=element(Z);    A=Gcoeff(1,:);    B=Gcoeff(2,:);% Generate matrix with hkl values. Generates an (2N+1)x(2N+1)x(2N+1)% matrix of Miller indices that will correspond to 3D matrix of Fourier% coefficients, V(g). At same time, generate 3D structure factor% matrix, Fhkl.    h=-N:N;    k=-N:N;    l=-N:N;    Fhkl=zeros(length(h),length(k),length(l));%     Vg=zeros(length(h),length(k),length(l));%    sa=zeros(1,numel(Vg));%    fs=zeros(1,numel(Vg));	numel=length(h)*length(k)*length(l);	sa=zeros(1,numel);	fs=zeros(1,numel);    count=1;    for m=1:length(h)        for n=1:length(k)            for p=1:length(l)                % First HKL matrices as vectors                g=[h(m) k(n) l(p)];                %hkl(m,n,p)={g};                % Now Vg matrix                SS=(g*g')/a^2;                S=0.5*sqrt(SS); % S=1/2*d          sa(count)=S;                         % Doyle-Turner SF for electrons is Sum(i=1,4)A(i)*                % exp(-B(i)*S^2)                f=0;                for q=1:4                    f=f+A(q)*exp(-B(q)*S^2);                end                fs(count)=f*exp(-DW*S^2); % DW factor                % Now form structure factor.                             Fhkl(m,n,p)=0;                for w=1:4                    Fhkl(m,n,p)=Fhkl(m,n,p)+fs(count)*exp(2*pi*1i*g*R{w}');                end                count=count+1;            end        end    end% Now form Vg matrix: Fourier coefficients in volts.    Vg=(47.87*Fhkl)/(a^3);    plot(fs,sa);                            